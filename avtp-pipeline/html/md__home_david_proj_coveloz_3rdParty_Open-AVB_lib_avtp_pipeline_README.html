<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Open-AVB AVTP Pipeline SDK: STC AVTP Pipeline Contribution Notes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stc_logo_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-AVB AVTP Pipeline SDK
   &#160;<span id="projectnumber">1.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Table&#160;of&#160;Contents</span></a></li>
      <li class="current"><a href="pages.html"><span>Topics</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">STC AVTP Pipeline Contribution Notes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>General Status</h2>
<ul>
<li>Consider the AVTP Pipeline a work in progress.</li>
<li>Integrated with OpenAVB:<ul>
<li>gPTP</li>
<li>MSRP</li>
<li>igb direct for packet TX.</li>
<li>igb credit based shaper</li>
<li>build system</li>
</ul>
</li>
<li>Not yet integreated with OpenAVB:<ul>
<li>MAAP</li>
</ul>
</li>
<li>Credit-based shaper algorithm is not used for individual streams.</li>
<li>Testing of various mappings and benchmarking has been performed. Look at the end of this file for benchmark results.</li>
<li>Documentation and doc generation has not been fully updated.</li>
</ul>
<h2>Building Current OpenAVB</h2>
<h3>Tool chain and libraries</h3>
<ul>
<li>Ubuntu 14.04</li>
<li>Install dependencies for OpenAVB ($ sudo apt-get install ...)<ul>
<li>$ sudo apt-get install build-essential</li>
<li>$ sudo apt-get install libpcap-dev</li>
<li>$ sudo apt-get install libpci-dev</li>
<li>$ sudo apt-get install libsndfile1-dev</li>
<li>$ sudo apt-get install libjack-dev</li>
<li>$ sudo apt-get install linux-headers-generic<ul>
<li>linux-headers (same version as the kernel you're building for)</li>
</ul>
</li>
</ul>
</li>
<li>Install dependencies for AVTP pipeline<ul>
<li>$ sudo apt-get install libglib2.0-dev</li>
<li>$ sudo apt-get install libgstreamer0.10-dev</li>
<li>$ sudo apt-get install libgstreamer-plugins-base0.10-dev</li>
<li>$ sudo apt-get install libasound2-dev</li>
</ul>
</li>
</ul>
<h3>Building everything</h3>
<ul>
<li>Building from the repo root</li>
<li>$ ARCH=I210 make all</li>
</ul>
<h3>Building just AVTP pipeline.</h3>
<ul>
<li>$ make avtp_pipeline</li>
</ul>
<p>Binaries will be installed in lib/avtp_pipeline/build/bin.</p>
<h3>Building AVTP pipeline without SRP.</h3>
<ul>
<li>$ AVB_FEATURE_ENDPOINT=0 make avtp_pipeline</li>
</ul>
<p>Make sure to call <code>make avtp_pipeline_clean</code> before.</p>
<h3>Building AVTP pipeline documentation</h3>
<ul>
<li>$ make avtp_pipeline_doc</li>
</ul>
<h2>Running OpenAVB daemons</h2>
<ul>
<li>Helper scripts in the repo root.</li>
<li><code>$ sudo ./run_igb.sh eth1</code><ul>
<li>Load the igb driver. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
<li><code>$ sudo ./run_gptp.sh eth1</code><ul>
<li>Start gptp daemon. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
<li><code>$ sudo ./run_srp.sh eth1</code><ul>
<li>Start msrp daemon. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
</ul>
<h2>Running OpenAVB simple talker example</h2>
<ul>
<li><code>$ sudo ./run_simple_talker.sh eth1</code><ul>
<li>Run the current OpenAVB simple talker example. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
</ul>
<h2>Running STC Echo Talker</h2>
<ul>
<li><code>$ sudo ./run_echo_talker.sh eth1</code><ul>
<li>Run the AVTP Echo talker test stream. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
</ul>
<h2>Running STC Echo Listener</h2>
<ul>
<li><code>$ sudo ./run_echo_listener.sh eth1</code><ul>
<li>Run the AVTP Echo talker test stream. Supply the interface name (ethx) as parameter.</li>
</ul>
</li>
</ul>
<h2>Benchmark results</h2>
<p>All test done on DELL Optiplex 755 with Intel Core 2 Duo CPU E8400 @ 3.00GHz</p>
<table class="doxtable">
<tr>
<th align="center">Type </th><th>Comment </th><th align="center">Class </th><th align="right">Streams </th><th align="right">CPU Talker </th><th align="right">CPU Listener  </th></tr>
<tr>
<td align="center">61883-6 </td><td>48kHz stereo </td><td align="center">A </td><td align="right">1 </td><td align="right">3.2%</td><td align="right">4.9% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">2 </td><td align="right">22.8%</td><td align="right">9.3% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">4 </td><td align="right">28.2%</td><td align="right">20.3% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">8 </td><td align="right">39.7%</td><td align="right">35.0% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">16 </td><td align="right">60.8%</td><td align="right">73.1% </td></tr>
<tr>
<td align="center">aaf </td><td>48kHz stereo </td><td align="center">A </td><td align="right">1 </td><td align="right">3.4%</td><td align="right">4.8% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">2 </td><td align="right">22.7%</td><td align="right">8.9% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">4 </td><td align="right">28.7%</td><td align="right">19.4% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">8 </td><td align="right">40.5%</td><td align="right">35.7% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">16 </td><td align="right">63.0%</td><td align="right">74.8% </td></tr>
<tr>
<td align="center">h264 </td><td>4675 Kbps vbr</td><td align="center">A </td><td align="right">1 </td><td align="right">3.2%</td><td align="right">27.0% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">2 </td><td align="right">6.4%</td><td align="right">59.8% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">4 </td><td align="right">10.5%</td><td align="right">108.1% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">6 </td><td align="right">15.6%</td><td align="right">149.9% </td></tr>
<tr>
<td align="center">mpeg2ts </td><td>1405 Kbps vbr</td><td align="center">A </td><td align="right">1 </td><td align="right">2.5%</td><td align="right">14.7% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">2 </td><td align="right">5.0%</td><td align="right">40.9% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">4 </td><td align="right">7.6%</td><td align="right">86.3% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">6 </td><td align="right">10.7%</td><td align="right">123.5% </td></tr>
<tr>
<td align="center">mjpeg </td><td>live camera </td><td align="center">A </td><td align="right">1 </td><td align="right">11.5%</td><td align="right">10.2% </td></tr>
<tr>
<td align="center">mjpeg </td><td>videotestsrc </td><td align="center">A </td><td align="right">1 </td><td align="right">10.0%</td><td align="right">6.4% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">2 </td><td align="right">21.4%</td><td align="right">13.0% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">4 </td><td align="right">40.5%</td><td align="right">26.9% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center"></td><td align="right">6 </td><td align="right">57.7%</td><td align="right">42.0% </td></tr>
<tr>
<td align="center"></td><td></td><td align="center">B </td><td align="right">12 </td><td align="right">113.0%</td><td align="right">79.0% </td></tr>
</table>
<h2>More examples</h2>
<p>Below are examples of AVTP pipeline usage with various stream types (mappings). These commands were used for generating benchmark results above. AVTP pipeline was compiled without SRP support (<code>AVB_FEATURE_ENDPOINT=0 make avtp_pipeline</code>). </p>
<pre class="fragment">IFNAME=eth0
STREAMS=7
CLASS=A
RATE=8000
TRANSIT_USEC=2000
REPORT=0 # statistics display interval in seconds (0 turns off statistics)

# AAF talker
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad aaf_file_talker.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,map_nv_sparse_mode=0,intf_nv_file_name=test01.wav,report_seconds=$REPORT
# AAF listener
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad aaf_listener_auto.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,map_nv_sparse_mode=0,intf_nv_audio_endian=big,report_seconds=$REPORT

# 61883-6 talker
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad wav_file_talker.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,intf_nv_file_name=test01.wav,report_seconds=$REPORT
# 61883-6 listener
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad alsa_listener.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT

# H264 talker
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad h264_gst_talker.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT
# H264 listener
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad h264_gst_listener.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT

# MJPEG talker
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad mjpeg_gst_talker.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT
# MJPEG listener
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad mjpeg_gst_listener.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT

# MPEG2TS talker
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad mpeg2ts_file_talker.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT
# MPEG2TS listener
sudo ./openavb_harness -I $IFNAME -s $STREAMS -d 0 -a a0:36:9f:2d:01:ad mpeg2ts_gst_listener.ini,sr_class=$CLASS,map_nv_tx_rate=$RATE,max_transit_usec=$TRANSIT_USEC,report_seconds=$REPORT</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 30 2015 08:29:35 for Open-AVB AVTP Pipeline SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
