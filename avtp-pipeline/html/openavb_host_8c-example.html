<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Open-AVB AVTP Pipeline SDK: openavb_host.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stc_logo_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open-AVB AVTP Pipeline SDK
   &#160;<span id="projectnumber">1.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Table&#160;of&#160;Contents</span></a></li>
      <li><a href="pages.html"><span>Topics</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">openavb_host.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Talker / Listener example host application.</p>
<div class="fragment"><div class="line"><span class="comment">/*************************************************************************************************************</span></div>
<div class="line"><span class="comment">Copyright (c) 2012-2015, Symphony Teleca Corporation, a Harman International Industries, Incorporated company</span></div>
<div class="line"><span class="comment">All rights reserved.</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment">modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">1. Redistributions of source code must retain the above copyright notice, this</span></div>
<div class="line"><span class="comment">   list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment">2. Redistributions in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><span class="comment">   this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><span class="comment">   and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS LISTED &quot;AS IS&quot; AND</span></div>
<div class="line"><span class="comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></div>
<div class="line"><span class="comment">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><span class="comment">DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS LISTED BE LIABLE FOR</span></div>
<div class="line"><span class="comment">ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></div>
<div class="line"><span class="comment">(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></div>
<div class="line"><span class="comment">LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span></div>
<div class="line"><span class="comment">ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment">(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></div>
<div class="line"><span class="comment">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">Attributions: The inih library portion of the source code is licensed from </span></div>
<div class="line"><span class="comment">Brush Technology and Ben Hoyt - Copyright (c) 2009, Brush Technology and Copyright (c) 2009, Ben Hoyt. </span></div>
<div class="line"><span class="comment">Complete license and copyright information can be found at </span></div>
<div class="line"><span class="comment">https://github.com/benhoyt/inih/commit/74d2ca064fb293bc60a77b0bd068075b293cf175.</span></div>
<div class="line"><span class="comment">*************************************************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">* MODULE SUMMARY : Talker listener test host implementation.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="openavb__tl__pub_8h.html">openavb_tl_pub.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;openavb_plugin.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;openavb_trace_pub.h&quot;</span></div>
<div class="line"><span class="preprocessor">#ifdef AVB_FEATURE_GSTREAMER</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;gst/gst.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define AVB_LOG_COMPONENT   &quot;TL Host&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;openavb_log_pub.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> bRunning = <a name="a0"></a><a class="code" href="openavb__types__base__pub_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Platform indendent mapping modules</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapPipeInitialize(<a name="_a1"></a><a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a name="_a2"></a><a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapAVTPAudioInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapCtrlInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapH264Initialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapMjpegInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapMpeg2tsInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapNullInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbMapUncmpAudioInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__map__cb__t.html">openavb_map_cb_t</a> *pMapCB, <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> inMaxTransitUsec);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Platform indendent interface modules</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfEchoInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a name="_a3"></a><a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfCtrlInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfLoggerInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfNullInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfToneGenInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfViewerInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Linux interface modules</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfAlsaInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfMjpegGstInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfMpeg2tsFileInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfMpeg2tsGstInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfWavFileInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">bool</span> openavbIntfH264RtpGstInitialize(<a class="code" href="structmedia__q__t.html">media_q_t</a> *pMediaQ, <a class="code" href="structopenavb__intf__cb__t.html">openavb_intf_cb_t</a> *pIntfCB);</div>
<div class="line"></div>
<div class="line"><span class="comment">/***********************************************</span></div>
<div class="line"><span class="comment"> * Signal handler - used to respond to signals.</span></div>
<div class="line"><span class="comment"> * Allows graceful cleanup.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> openavbTLSigHandler(<span class="keywordtype">int</span> signal)</div>
<div class="line">{</div>
<div class="line">    AVB_TRACE_ENTRY(AVB_TRACE_HOST);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (signal == SIGINT) {</div>
<div class="line">        AVB_LOG_INFO(<span class="stringliteral">&quot;Host shutting down&quot;</span>);</div>
<div class="line">        bRunning = <a name="a4"></a><a class="code" href="openavb__types__base__pub_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (signal == SIGUSR1) {</div>
<div class="line">        AVB_LOG_DEBUG(<span class="stringliteral">&quot;Waking up streaming thread&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        AVB_LOG_ERROR(<span class="stringliteral">&quot;Unexpected signal&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    AVB_TRACE_EXIT(AVB_TRACE_HOST);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> openavbTlHostUsage(<span class="keywordtype">char</span> *programName)</div>
<div class="line">{</div>
<div class="line">    printf(</div>
<div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;Usage: %s [options] file...\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -I val     Use given (val) interface globally, can be overriden by giving the ifname= option to the config line.\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;Examples:\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  %s talker.ini\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    Start 1 stream with data from the ini file.\n\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  %s talker1.ini talker2.ini\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    Start 2 streams with data from the ini files.\n\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  %s -I eth0 talker1.ini talker2.ini\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    Start 2 streams with data from the ini files, both talkers use eth0 interface.\n\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  %s -I eth0 talker1.ini talker2.ini listener1.ini,ifname=pcap:eth0\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;    Start 3 streams with data from the ini files, talkers 1&amp;2 use eth0 interface, listener1 use pcap:eth0.\n\n&quot;</span></div>
<div class="line">        ,</div>
<div class="line">        programName, programName, programName, programName, programName);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/**********************************************</span></div>
<div class="line"><span class="comment"> * main</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    AVB_TRACE_ENTRY(AVB_TRACE_HOST);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> iniIdx = 0;</div>
<div class="line">    <span class="keywordtype">char</span> *programName;</div>
<div class="line">    <span class="keywordtype">char</span> *optIfnameGlobal = <a name="a5"></a><a class="code" href="openavb__types__base__pub_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    programName = strrchr(argv[0], <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line">    programName = programName ? programName + 1 : argv[0];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (argc &lt; 2) {</div>
<div class="line">        openavbTlHostUsage(programName);</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="openavb__tl__pub_8h.html#af231d6531d24afcf31511425dd4869d2">tl_handle_t</a> *tlHandleList = <a class="code" href="openavb__types__base__pub_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    <span class="keywordtype">int</span> i1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Process command line</span></div>
<div class="line">    <span class="keywordtype">bool</span> optDone = <a class="code" href="openavb__types__base__pub_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line">    <span class="keywordflow">while</span> (!optDone) {</div>
<div class="line">        <span class="keywordtype">int</span> opt = getopt(argc, argv, <span class="stringliteral">&quot;hI:&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (opt != EOF) {</div>
<div class="line">            <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:</div>
<div class="line">                    optIfnameGlobal = strdup(optarg);</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                    openavbTlHostUsage(programName);</div>
<div class="line">                    exit(-1);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            optDone = <a class="code" href="openavb__types__base__pub_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    osalAVBInitialize(optIfnameGlobal);</div>
<div class="line"></div>
<div class="line">    iniIdx = optind;</div>
<div class="line">    <a class="code" href="openavb__types__base__pub_8h.html#a696390429f2f3b644bde8d0322a24124">U32</a> tlCount = argc - iniIdx;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!<a name="a6"></a><a class="code" href="openavb__tl__pub_8h.html#aefac1b8343b87d569a38ecbfc87de883">openavbTLInitialize</a>(tlCount)) {</div>
<div class="line">        AVB_LOG_ERROR(<span class="stringliteral">&quot;Unable to initialize talker listener library&quot;</span>);</div>
<div class="line">        osalAVBFinalize();</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Setup signal handler</span></div>
<div class="line">    <span class="comment">// We catch SIGINT and shutdown cleanly</span></div>
<div class="line">    <span class="keywordtype">bool</span> err;</div>
<div class="line">    <span class="keyword">struct </span>sigaction sa;</div>
<div class="line">    sa.sa_handler = openavbTLSigHandler;</div>
<div class="line">    sigemptyset(&amp;sa.sa_mask);</div>
<div class="line">    sa.sa_flags = 0;</div>
<div class="line">    err = sigaction(SIGINT, &amp;sa, <a class="code" href="openavb__types__base__pub_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (err)</div>
<div class="line">    {</div>
<div class="line">        AVB_LOG_ERROR(<span class="stringliteral">&quot;Failed to setup SIGINT handler&quot;</span>);</div>
<div class="line">        osalAVBFinalize();</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line">    err = sigaction(SIGUSR1, &amp;sa, <a class="code" href="openavb__types__base__pub_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (err)</div>
<div class="line">    {</div>
<div class="line">        AVB_LOG_ERROR(<span class="stringliteral">&quot;Failed to setup SIGUSR1 handler&quot;</span>);</div>
<div class="line">        osalAVBFinalize();</div>
<div class="line">        exit(-1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    registerStaticMapModule(openavbMapPipeInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapAVTPAudioInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapCtrlInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapH264Initialize);</div>
<div class="line">    registerStaticMapModule(openavbMapMjpegInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapMpeg2tsInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapNullInitialize);</div>
<div class="line">    registerStaticMapModule(openavbMapUncmpAudioInitialize);</div>
<div class="line"></div>
<div class="line">    registerStaticIntfModule(openavbIntfEchoInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfCtrlInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfLoggerInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfNullInitialize);</div>
<div class="line">    <span class="comment">//registerStaticIntfModule(openavbIntfToneGenInitialize);</span></div>
<div class="line">    registerStaticIntfModule(openavbIntfViewerInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfAlsaInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfMjpegGstInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfMpeg2tsFileInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfMpeg2tsGstInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfWavFileInitialize);</div>
<div class="line">    registerStaticIntfModule(openavbIntfH264RtpGstInitialize);</div>
<div class="line"></div>
<div class="line">    tlHandleList = calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="openavb__tl__pub_8h.html#af231d6531d24afcf31511425dd4869d2">tl_handle_t</a>) * tlCount);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open all streams</span></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; tlCount; i1++) {</div>
<div class="line">        tlHandleList[i1] = <a name="a7"></a><a class="code" href="openavb__tl__pub_8h.html#a4952af6d10075781ffb320af2ff1665b">openavbTLOpen</a>();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Parse ini and configure all streams</span></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; tlCount; i1++) {</div>
<div class="line">        <a name="_a8"></a><a class="code" href="structopenavb__tl__cfg__t.html">openavb_tl_cfg_t</a> cfg;</div>
<div class="line">        <a name="_a9"></a><a class="code" href="structopenavb__tl__cfg__name__value__t.html">openavb_tl_cfg_name_value_t</a> NVCfg;</div>
<div class="line">        <span class="keywordtype">char</span> iniFile[1024];</div>
<div class="line"></div>
<div class="line">        snprintf(iniFile, <span class="keyword">sizeof</span>(iniFile), <span class="stringliteral">&quot;%s&quot;</span>, argv[i1 + iniIdx]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (optIfnameGlobal &amp;&amp; !strcasestr(iniFile, <span class="stringliteral">&quot;,ifname=&quot;</span>)) {</div>
<div class="line">            snprintf(iniFile + strlen(iniFile), <span class="keyword">sizeof</span>(iniFile), <span class="stringliteral">&quot;,ifname=%s&quot;</span>, optIfnameGlobal);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a name="a10"></a><a class="code" href="openavb__tl__pub_8h.html#aed9fe907543be2360d998d0322936981">openavbTLInitCfg</a>(&amp;cfg);</div>
<div class="line">        memset(&amp;NVCfg, 0, <span class="keyword">sizeof</span>(NVCfg));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!<a name="a11"></a><a class="code" href="openavb__tl__pub_8h.html#a64c4995d770389ac6518a2fe1f7be7df">openavbTLReadIniFileOsal</a>(tlHandleList[i1], iniFile, &amp;cfg, &amp;NVCfg)) {</div>
<div class="line">            AVB_LOGF_ERROR(<span class="stringliteral">&quot;Error reading ini file: %s\n&quot;</span>, argv[i1 + 1]);</div>
<div class="line">            osalAVBFinalize();</div>
<div class="line">            exit(-1);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (!<a name="a12"></a><a class="code" href="openavb__tl__pub_8h.html#af3f5f9270f359618de3497ab9a469b83">openavbTLConfigure</a>(tlHandleList[i1], &amp;cfg, &amp;NVCfg)) {</div>
<div class="line">            AVB_LOGF_ERROR(<span class="stringliteral">&quot;Error configuring: %s\n&quot;</span>, argv[i1 + 1]);</div>
<div class="line">            osalAVBFinalize();</div>
<div class="line">            exit(-1);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> i2;</div>
<div class="line">        <span class="keywordflow">for</span> (i2 = 0; i2 &lt; NVCfg.<a name="a13"></a><a class="code" href="structopenavb__tl__cfg__name__value__t.html#a99050aad650fd226d6a90b036ed8a82d">nLibCfgItems</a>; i2++) {</div>
<div class="line">            free(NVCfg.<a name="a14"></a><a class="code" href="structopenavb__tl__cfg__name__value__t.html#ac078639c2178c7d4a989e4ab4feccd7f">libCfgNames</a>[i2]);</div>
<div class="line">            free(NVCfg.<a name="a15"></a><a class="code" href="structopenavb__tl__cfg__name__value__t.html#a7f1b71345c2d90df2c4481765fe40717">libCfgValues</a>[i2]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef AVB_FEATURE_GSTREAMER</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">// If we&#39;re supporting the interface modules which use GStreamer,</span></div>
<div class="line">    <span class="comment">// initialize GStreamer here to avoid errors.</span></div>
<div class="line">    gst_init(0, <a class="code" href="openavb__types__base__pub_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; tlCount; i1++) {</div>
<div class="line">        <a name="a16"></a><a class="code" href="openavb__tl__pub_8h.html#a7af14e9b869ab4c29a4d7f51ab78a28a">openavbTLRun</a>(tlHandleList[i1]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (bRunning) {</div>
<div class="line">        sleep(1);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; tlCount; i1++) {</div>
<div class="line">        <a name="a17"></a><a class="code" href="openavb__tl__pub_8h.html#aafead2b8bb18266907f374c904292490">openavbTLStop</a>(tlHandleList[i1]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; tlCount; i1++) {</div>
<div class="line">        <a name="a18"></a><a class="code" href="openavb__tl__pub_8h.html#ae373dc0cd3617f44e3205bbc2f6d84f4">openavbTLClose</a>(tlHandleList[i1]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="a19"></a><a class="code" href="openavb__tl__pub_8h.html#a3f172a9d0b7b72b0835954442461b458">openavbTLCleanup</a>();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef AVB_FEATURE_GSTREAMER</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">// If we&#39;re supporting the interface modules which use GStreamer,</span></div>
<div class="line">    <span class="comment">// De-initialize GStreamer to clean up resources.</span></div>
<div class="line">    gst_deinit();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    osalAVBFinalize();</div>
<div class="line"></div>
<div class="line">    AVB_TRACE_EXIT(AVB_TRACE_HOST);</div>
<div class="line">    exit(0);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 30 2015 08:29:35 for Open-AVB AVTP Pipeline SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
