\hypertarget{shm__test_8cpp}{}\section{daemons/gptp/linux/shm\+\_\+test/shm\+\_\+test.cpp 파일 참조}
\label{shm__test_8cpp}\index{daemons/gptp/linux/shm\+\_\+test/shm\+\_\+test.\+cpp@{daemons/gptp/linux/shm\+\_\+test/shm\+\_\+test.\+cpp}}
{\ttfamily \#include $<$iostream$>$}\\*
{\ttfamily \#include $<$fstream$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$sys/mman.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$pthread.\+h$>$}\\*
{\ttfamily \#include \char`\"{}linux\+\_\+ipc.\+hpp\char`\"{}}\\*
shm\+\_\+test.\+cpp에 대한 include 의존 그래프
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{shm__test_8cpp__incl}
\end{center}
\end{figure}
\subsection*{함수}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{parse_8c_aec6fcb673ff035718c238c8c9d544c47}{uint64\+\_\+t} \hyperlink{shm__test_8cpp_ad53b643c9bba243328df06d314743bdd}{get\+Cpu\+Frequency} (void)
\item 
int \hyperlink{shm__test_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{함수 문서화}
\index{shm\+\_\+test.\+cpp@{shm\+\_\+test.\+cpp}!get\+Cpu\+Frequency@{get\+Cpu\+Frequency}}
\index{get\+Cpu\+Frequency@{get\+Cpu\+Frequency}!shm\+\_\+test.\+cpp@{shm\+\_\+test.\+cpp}}
\subsubsection[{\texorpdfstring{get\+Cpu\+Frequency(void)}{getCpuFrequency(void)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf uint64\+\_\+t} get\+Cpu\+Frequency (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}\hypertarget{shm__test_8cpp_ad53b643c9bba243328df06d314743bdd}{}\label{shm__test_8cpp_ad53b643c9bba243328df06d314743bdd}


shm\+\_\+test.\+cpp 파일의 49 번째 라인에서 정의되었습니다.


\begin{DoxyCode}
50 \{
51     \hyperlink{parse_8c_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t} freq = 0;
52     std::string line;
53     std::ifstream cpuinfo(\textcolor{stringliteral}{"/proc/cpuinfo"});
54     \textcolor{keywordflow}{if} (cpuinfo.is\_open())
55     \{
56         \textcolor{keywordflow}{while} ( getline (cpuinfo,line) )
57         \{
58             \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"MHz"}) != line.npos)
59                 \textcolor{keywordflow}{break};
60         \}
61         cpuinfo.close();
62     \}
63     \textcolor{keywordflow}{else} std::cout << \textcolor{stringliteral}{"Unable to open file"};
64 
65     \textcolor{keywordtype}{size\_t} pos = line.find(\textcolor{stringliteral}{":"});
66     \textcolor{keywordflow}{if} (pos != line.npos) \{
67         std::string mhz\_str = line.substr(pos+2, line.npos - pos);
68         \textcolor{keywordtype}{double} freq1 = strtod(mhz\_str.c\_str(), \hyperlink{openavb__types__base__pub_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
69         freq = freq1 * 1000000ULL;
70     \}
71     \textcolor{keywordflow}{return} freq;
72 \}
\end{DoxyCode}


이 함수를 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{shm__test_8cpp_ad53b643c9bba243328df06d314743bdd_icgraph}
\end{center}
\end{figure}


\index{shm\+\_\+test.\+cpp@{shm\+\_\+test.\+cpp}!main@{main}}
\index{main@{main}!shm\+\_\+test.\+cpp@{shm\+\_\+test.\+cpp}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$argv[])}{main(int argc, char *argv[])}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}\hypertarget{shm__test_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{}\label{shm__test_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


shm\+\_\+test.\+cpp 파일의 74 번째 라인에서 정의되었습니다.


\begin{DoxyCode}
75 \{
76     \textcolor{keywordtype}{int} shm\_fd = shm\_open(\hyperlink{linux__ipc_8hpp_a86393b21e6f74e9870d92149e7fe7f20}{SHM\_NAME}, O\_RDONLY, 0666);
77 
78     \textcolor{keywordflow}{if}( shm\_fd < 0) \{
79         fprintf(stderr, \textcolor{stringliteral}{"shm\_open(). %s\(\backslash\)n"}, strerror(errno));
80         \textcolor{keywordflow}{return} -1;
81     \}
82     \textcolor{keywordtype}{char} *addr = (\textcolor{keywordtype}{char}*)mmap(\hyperlink{openavb__types__base__pub_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{linux__ipc_8hpp_a16e67aa18d42bbdb08ac9af1c8d0f4f9}{SHM\_SIZE}, PROT\_READ, MAP\_SHARED, shm\_fd, 0);
83 
84     \textcolor{keywordflow}{if}( addr == MAP\_FAILED ) \{
85         fprintf(stderr, \textcolor{stringliteral}{"Error on mmap. Aborting.\(\backslash\)n"});
86         \textcolor{keywordflow}{return} -1;
87     \}
88     fprintf(stdout, \textcolor{stringliteral}{"--------------------------------------------\(\backslash\)n"});
89     \textcolor{keywordtype}{int} buf\_offset = 0;
90     buf\_offset += \textcolor{keyword}{sizeof}(pthread\_mutex\_t);
91     \hyperlink{structg_ptp_time_data}{gPtpTimeData} *ptpData = (\hyperlink{structg_ptp_time_data}{gPtpTimeData}*)(addr+buf\_offset);
92     \textcolor{comment}{/*TODO: Scale to ns*/}
93     \hyperlink{parse_8c_aec6fcb673ff035718c238c8c9d544c47}{uint64\_t} freq = \hyperlink{shm__test_8cpp_ad53b643c9bba243328df06d314743bdd}{getCpuFrequency}();
94     printf(\textcolor{stringliteral}{"Frequency %lu Hz\(\backslash\)n"}, freq);
95 
96     fprintf(stdout, \textcolor{stringliteral}{"ml phoffset %ld\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_a707b32410dd96584191405fcc6b1b10d}{ml\_phoffset});
97     fprintf(stdout, \textcolor{stringliteral}{"ml freq offset %Lf\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_aafeb4d0fa7d3cb53ee3686b804e47617}{ml\_freqoffset});
98     fprintf(stdout, \textcolor{stringliteral}{"ls phoffset %ld\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_a092b9f356daa2757877b51e4084366be}{ls\_phoffset});
99     fprintf(stdout, \textcolor{stringliteral}{"ls freq offset %Lf\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_a396f365f5e7c66610f076359c5d99c6e}{ls\_freqoffset});
100     fprintf(stdout, \textcolor{stringliteral}{"local time %llu\(\backslash\)n\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long}) ptpData->
      \hyperlink{structg_ptp_time_data_a77a3c33b68032d5db3c0c556a80ef651}{local\_time});
101 
102     fprintf(stdout, \textcolor{stringliteral}{"gptp grandmaster id %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\(\backslash\)n"},
103             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[0], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[1],
104             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[2], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[3],
105             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[4], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[5],
106             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[6], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a91da646ac8f2da272fe3b8941c3f4d54}{gptp\_grandmaster\_id}[7]);
107     fprintf(stdout, \textcolor{stringliteral}{"gptp domain number %u\(\backslash\)n\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_ac53b4e61c0f960e16c86cfe678ca256d}{gptp\_domain\_number});
108 
109     fprintf(stdout, \textcolor{stringliteral}{"clock identity %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x\(\backslash\)n"},
110             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[0], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[1],
111             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[2], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[3],
112             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[4], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[5],
113             (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[6], (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_af57b2186850d88240e6095da54758a2e}{clock\_identity}[7]);
114     fprintf(stdout, \textcolor{stringliteral}{"priority1 %u\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af98f08e3d1b016cd549310197ba8673c}{priority1});
115     fprintf(stdout, \textcolor{stringliteral}{"clock\_class %u\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_aafe98ca785cdce0ce5eaa26f2930d2fe}{clock\_class});
116     fprintf(stdout, \textcolor{stringliteral}{"offset\_scaled\_log\_variance %d\(\backslash\)n"}, (\textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a022841cfc4d83dc906f116eec53f1d9a}{offset\_scaled\_log\_variance});
117     fprintf(stdout, \textcolor{stringliteral}{"clock\_accuracy %u\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a708d6d971b6be997cf8d3e683951ceb0}{clock\_accuracy});
118     fprintf(stdout, \textcolor{stringliteral}{"priority2 %u\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_ac04b889463a96b43985cb82020e3c39b}{priority2});
119     fprintf(stdout, \textcolor{stringliteral}{"domain\_number %u\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a96702548f5b9222af26319c695764b29}{domain\_number});
120     fprintf(stdout, \textcolor{stringliteral}{"log\_sync\_interval %d\(\backslash\)n"}, (\textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_a2d4950b4c6da4dfa67688dcaf6139c9d}{log\_sync\_interval});
121     fprintf(stdout, \textcolor{stringliteral}{"log\_announce\_interval %d\(\backslash\)n"}, (\textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a15bb50a04ecd3ec11563012afc7e24a7}{log\_announce\_interval});
122     fprintf(stdout, \textcolor{stringliteral}{"log\_pdelay\_interval %d\(\backslash\)n"}, (\textcolor{keywordtype}{int}) ptpData->
      \hyperlink{structg_ptp_time_data_a26544b553c0b251da8e632533f260a5d}{log\_pdelay\_interval});
123     fprintf(stdout, \textcolor{stringliteral}{"port\_number %u\(\backslash\)n\(\backslash\)n"}, (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) ptpData->\hyperlink{structg_ptp_time_data_af0afa7bb85d49ac5ff873fad86a48ec5}{port\_number});
124 
125     fprintf(stdout, \textcolor{stringliteral}{"sync count %u\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_ab918355ca94ac81d7397800a7ef77c0a}{sync\_count});
126     fprintf(stdout, \textcolor{stringliteral}{"pdelay count %u\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_a7557e8c3c5a258ba096b5c1c274f17bf}{pdelay\_count});
127     fprintf(stdout, \textcolor{stringliteral}{"asCapable %s\(\backslash\)n"}, ptpData->\hyperlink{structg_ptp_time_data_a15a09cf240fb37b905e4d4e1e9f5b9a1}{asCapable} ? \textcolor{stringliteral}{"True"} : \textcolor{stringliteral}{"False"});
128     fprintf(stdout, \textcolor{stringliteral}{"Port State %d\(\backslash\)n"}, (\textcolor{keywordtype}{int})ptpData->\hyperlink{structg_ptp_time_data_ae66554126902ed959a3b296ddd3204e8}{port\_state});
129     fprintf(stdout, \textcolor{stringliteral}{"process\_id %d\(\backslash\)n\(\backslash\)n"}, (\textcolor{keywordtype}{int})ptpData->\hyperlink{structg_ptp_time_data_aa5e5e89995d6bfb4b61b08fa89656812}{process\_id});
130 
131     \textcolor{keywordflow}{return} 0;
132 \}
\end{DoxyCode}


이 함수 내부에서 호출하는 함수들에 대한 그래프입니다.\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=248pt]{shm__test_8cpp_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


